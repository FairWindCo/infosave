{% extends 'vue_utils/vue_prime_template.html' %}
{% load static %}

{% block main_content %}
    <div id="APP">
        <p-panel header="Header Panel">
            <div class="p-grid">
                <div class="p-col-4">
                    <p-inputtext v-model="test_value"></p-inputtext>
                </div>
                <div class="p-col">
                    <p-inputnumber v-model="test_value"></p-inputnumber>
                </div>
                <div class="p-col">
                    <p-button label="Submit" icon="pi pi-check"/>
                </div>
                <div class="p-col-2">
                    <p-splitbtn label="Save" icon="pi pi-plus" :model="items"></p-splitbtn>
                </div>
            </div>
        </p-panel>
    </div>
{% endblock %}

{% block css_header_extend %}
    <style>
    </style>
{% endblock %}

{% block vue_app_config %}
{% endblock %}

{% block vue_app_init %}
    <script type="module">

        const APP_CONFIG = {
            delimiters: ["@{", "}@"],
            data() {
                return {
                    'test': 'test',
                    'test_value': 0,
                    'items': [
                        {
                            label: 'Update',
                            icon: 'pi pi-refresh',
                        },
                        {
                            label: 'Delete',
                            icon: 'pi pi-times',
                        },
                    ],
                }
            },
            components: {
                'p-button': primevue.button,
                'p-inputtext': primevue.inputtext,
                'p-checkbox': primevue.checkbox,
                'p-inputnumber': primevue.inputnumber,
                'p-inputmask': primevue.inputmask,
                'p-inputswitch': primevue.inputswitch,
                'p-password': primevue.password,
                'p-radiobutton': primevue.radiobutton,
                'p-menu': primevue.menu,
                'p-splitbtn': primevue.splitbutton,
                'p-sidebar': primevue.sidebar,
                'p-dialog': primevue.dialog,
                'p-inlinemessage': primevue.inlinemessage,
                'p-calendar': primevue.calendar,
                'p-selectbutton': primevue.selectbutton,
                'p-slider': primevue.slider,
                'p-togglebutton': primevue.togglebutton,
                'p-tristatecheckbox': primevue.tristatecheckbox,
                'p-paginator': primevue.paginator,
                'p-tooltip': primevue.tooltip,
                'p-message': primevue.message,
                'p-panel': primevue.panel,
                'tab-list': {
                    delimiters: ["@{", "}@"],
                    props: ["device_data", "open_dialog"],
                    emits: ["view-graph", "view-table"],
                    template: `
                    <h5>Test Table</h5>
                    `
                },
                "tab-cards": {
                    delimiters: ["@{", "}@"],
                    props: ["device_data"],
                    template: `
                    <h5>TEST</h5>
                    `
                }
            },
            methods: {
                get_data_from_server(id, result_process) {
                    console.log(id)
                    this.element_id = id

                    let params = {
                        id: id,
                    }
                    if (this.start_value) {
                        params['from_date'] = new Date(this.start_value).toISOString()
                    }
                    if (this.end_value) {
                        params['end_date'] = new Date(this.end_value).toISOString()
                    }

                    fetch('{% url 'index' %}?' + new URLSearchParams(params))
                        .then((response) => {
                            if (response.ok) {
                                return response.json();
                            }
                            throw new Error('Network response was not ok');
                        })
                        .then((json) => {
                            console.log(json)
                            result_process(json)
                        })
                        .catch((error) => {
                            this.$notify({
                                title: 'ERROR',
                                message: error,
                                type: 'error'
                            });
                            console.log(error);
                        });
                },
                show_chart(id) {
                    console.log('chart', id)
                    this.chartDialogVisible = true
                    this.get_data_from_server(id, json => {
                        this.start_value = json.from_value
                        this.end_value = json.end_value
                        this.one_device_name = json.name
                        this.chart_labels = []
                        this.chart_datas = [[], []]
                        this.chart_titles = ['Температура', 'Влажность']

                        for (const val of json.values) {
                            this.chart_labels.push(val.date)
                            this.chart_datas[0].push(val.temp)
                            this.chart_datas[1].push(val.hom)
                        }
                    })
                },

            },
            mounted() {

            }

        }

        const app = Vue.createApp(APP_CONFIG)
        app.mount('#APP')
    </script>
{% endblock %}
{% block vue_app %}
{% endblock %}

